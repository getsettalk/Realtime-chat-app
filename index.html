<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100vh;
      background: #4b6cb7;
      /* fallback for old browsers */
      background: -webkit-linear-gradient(to right, #182848, #4b6cb7);
      /* Chrome 10-25, Safari 5.1-6 */
      background: linear-gradient(to right, #182848, #4b6cb7);
      /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */

    }

    .card {
      height: 100%;
    }

    .card-header {
      background: #f2709c;
      /* fallback for old browsers */
      background: -webkit-linear-gradient(to right, #ff9472, #f2709c);
      /* Chrome 10-25, Safari 5.1-6 */
      background: linear-gradient(to right, #ff9472, #f2709c);
      /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
      display: flex;
      justify-content: space-around;
      height: 30px;
      padding: 5px;
      text-align: center;
    }

    .card-body {
      padding: 0px !important;
    }

    .card-body #allSmS {
      width: 100%;
      /* background-color: #686868; */
      height: calc(100vh - 102px);
      overflow-y: auto;
      padding: 4px !important;
      padding-top: 5px !important;
      padding-bottom: 5px !important;

    }

    .card-body .inc {
      background: rgba(136, 4, 197, 0.661);
      padding: 3px;
      width: 60%;
      border-radius: 0px 10px 10px 0;
      margin-top: 5px;
      margin-bottom: 5px;
      box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
    }

    .card-body .inc #incID {
      color: #ececec;
      font-family: Times New Roman;
    }

    .card-body .out {
      background-color: rgba(34, 224, 133, 0.763);
      padding: 3px;
      width: 60%;
      border-radius: 10px 0px 0px 10px;
      margin-top: 5px;
      margin-bottom: 15px;
      box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
    }

    .card-body .out #outID {
      color: #686868;
      font-family: Times New Roman;
    }

    .card-footer {
      padding: 0;
      height: 50px;
    }

    .card-footer form {
      display: flex;
      justify-content: center;
      flex-direction: space-between;
      padding: 3px;
      gap: 5px;
    }

    .newUser {
      background: black !important;
      color: #fff;

    }

    @media screen And (max-width:800px) {
      .w-50 {
        width: 100% !important;
      }
    }

    @media screen And (min-width:762px) {

      /* width */
      ::-webkit-scrollbar {
        width: 10px;
      }

      /* Track */
      ::-webkit-scrollbar-track {
        background: #f1f1f1;
      }

      /* Handle */
      ::-webkit-scrollbar-thumb {
        background: #888;
      }

      /* Handle on hover */
      ::-webkit-scrollbar-thumb:hover {
        background: #555;
      }
    }
  </style>
  <title>Simple Free Chat App:online</title>
</head>

<body>
  <div class="card w-50">
    <div class="card-header">
      <span>Group chat to world wide</span>
      <span class=" fw-bold">Online : <span id="tonline" class="text-success fw-bold">0</span></span>
    </div>
    <div class="card-body ">
      <div id="allSmS">
      </div>
      <small id="typingUser"></small>
    </div>
    <div class="card-footer">

      <form id="form">
        <input type="text" placeholder="Enter Your Message" name="msg" id="msginput" class="form-control"
          autocomplete="off">
        <button class="btn btn-dark">Send</button>
      </form>
    </div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    var elem = document.documentElement;

    /* View in fullscreen */
    function openFullscreen() {
      if (elem.requestFullscreen) {
        elem.requestFullscreen();
      } else if (elem.webkitRequestFullscreen) { /* Safari */
        elem.webkitRequestFullscreen();
      } else if (elem.msRequestFullscreen) { /* IE11 */
        elem.msRequestFullscreen();
      }
    }

    var socket = io();
    var totalUser = 0;
    let uname;
    do {
      uname = prompt(" Enter Your Name")
    } while (!uname)
    if (uname !== null || uname.trim() !== '') {
      function capitalize(s) {
        //openFullscreen() // do full screen always
        return s[0].toUpperCase() + s.slice(1);
      }
      uname = capitalize(uname)
      // console.log(uname)
      var form = document.getElementById('form');

      var out = document.createElement('div');
      var input = document.getElementById('msginput');
      var typingUser = document.getElementById('typingUser');
      var allsms = document.getElementById('allSmS');

      function appendMsg(msg, type) {
        // console.log("Self", msg)
        let newdiv = document.createElement('div');
        newdiv.classList.add(type, 'float-end')
        let marker = `<div id="outID">${msg.name}</div>
          <span id="out-msg">${msg.msg} </span>
   `;
        newdiv.innerHTML = marker;
        allsms.appendChild(newdiv)

        allsms.scrollTop = allsms.scrollHeight;
      }

      function appendMsg2(msg, type) {
        let newdiv = document.createElement('div');
        newdiv.classList.add(type, 'float-start')
        let marker = `<div id="incID">${msg.name}</div>
          <span id="in-msg">${msg.msg}</span>
   `;
        newdiv.innerHTML = marker;
        allsms.appendChild(newdiv)
        window.navigator.vibrate(200)
        allsms.scrollTop = allsms.scrollHeight;
      }

      function appendNewUserMsg(msg, clr) {
        console.log(clr)
        let newdiv = document.createElement('div');
        newdiv.classList.add('inc', 'float-start', 'newUser', 'text-center')
        let marker = `
          <span id="in-msg" class=${clr}>${msg}</span>
   `;
        newdiv.innerHTML = marker;
        allsms.appendChild(newdiv)
        allsms.scrollTop = allsms.scrollHeight;
        window.navigator.vibrate(300)
      }

      function appendMsg3(newMsg) {
        let newdiv = document.createElement('div');
        newdiv.classList.add('bg-dark', 'text-light', 'text-center', 'w-100', 'p-2')
        let marker = `<span>${newMsg}</span>
   `;
        newdiv.innerHTML = marker;
        allsms.appendChild(newdiv)
      }

      form.addEventListener('submit', function (e) {
        e.preventDefault();
        if (input.value) {
          var custome = {
            name: uname,
            msg: input.value
          }
          socket.emit('chat message', custome);

          appendMsg(custome, 'out')

          input.value = '';
          typingUser.innerText = '';
        }
      });

      // show typing user
      let debounceTimer;
      const debounce = (uname, time) => {
        window.clearTimeout(debounceTimer);
        debounceTimer = window.setTimeout(() => {
          console.log("yyyy" + uname);
          socket.emit('TypingStatus', { TypingUsername: uname });
        }, time);
      };
      input.addEventListener('keydown', function () {
        console.log("chang")
        debounce(uname, 200)
      })
      // clear typing status every 300 second
      
        // const myTimeout =;
        function RemoveTypingStatus(){
          typingUser.innerText ='';
          // console.log("removed")
        }

      socket.on('chat message2', function (msg) {
        //console.log("cming",msg)
        appendMsg2(msg, 'inc');
      });
      socket.on('getTypingStatus', function (data) {
        // console.log("ty", data.TypingUsername)
        typingUser.innerText = "Typing:" + data.TypingUsername + "...";
        setTimeout(RemoveTypingStatus,1000)
        // appendMsg2(msg, 'inc');
      });

      socket.on('newuser', function (msg) {
        // console.log("cming",msg)

        window.navigator.vibrate(200)

        appendNewUserMsg(msg, 'text-success');

      });
      socket.on('Discuser', function (msg) {
        // console.log("cming",msg)

        appendNewUserMsg(msg, 'text-danger');

      });
      socket.on('status', function (msg) {
        var statusUser = document.getElementById('tonline');
        statusUser.innerText = msg;
        console.log("status", msg)
      });


    }
    // made by sujeet kumar @getsettalk
  </script>
</body>

</html>